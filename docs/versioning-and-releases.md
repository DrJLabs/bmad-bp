# Versioning and Releases

BMAD now ships releases automatically from `main` using the GitHub-only semantic-release workflow delivered in the [Release Governance Modernization focused epic](bmad/focused-epics/release-governance/epic.md). The flow relies entirely on GitHub Actions and the repository `GITHUB_TOKEN`; no npm publishing takes place.

## üöÄ Automated Release Workflow

1. Merge a Conventional Commit-compliant pull request into `main`.
2. GitHub Actions triggers `.github/workflows/release.yaml`.
3. The workflow installs dependencies, runs validation (`npm run validate`, `npm run format:check`, `npm run lint`), and executes `semantic-release`.
4. `semantic-release` bumps `package.json`, `package-lock.json`, and `tools/installer/package.json`, updates `CHANGELOG.md`, creates a git tag, and drafts rich release notes through `@semantic-release/github`.
5. Tarballs generated by `@semantic-release/npm` (with `npmPublish: false`) are attached to the GitHub Release for download.

Because the automation runs on every push to `main`, you get predictable, incremental releases without manual intervention.

## üîê Permissions & Evidence

Refer to [Release Automation ‚Äì Evidence capture checklist](release-automation.md#evidence-capture-checklist-story-1-1-4) for the step-by-step log download and retention guidance; record the verification timestamp in Story 1 change log each time you validate anchors.

- The workflow sets `permissions: contents: write`. Dropping permissions to `contents: read` should cause the job to fail gracefully (REL-T3) and produce evidence that the repository token is required.
- Capture the dry-run output (`npx semantic-release --dry-run --no-ci`), the Actions run ID, the GitHub Release URL, and the restricted-permission failure log in the story change log for auditability.

## üìù Manual Release Options

Need a controlled release outside the normal merge flow?

1. Head to **GitHub Actions ‚Üí Release** and trigger the workflow with ‚ÄúRun workflow‚Äù.
2. (Legacy) The **Manual Release** workflow remains available for emergency patches; it now reuses the GitHub-only configuration so no npm credentials are required.

## üõ†Ô∏è Developer Tips

<a id="developer-tips"></a>

- Keep commit messages in Conventional Commit format (`feat:`, `fix:`, `chore:`, etc.) so semantic-release can determine the correct version bump. Use the [version mapping quick reference](release-automation.md#version-mapping-quick-reference-story-12-ac1) to double-check the expected bump before merging.
- Use the provided commit template for helpful scaffolding:
  ```bash
  git config commit.template .github/commit-template.txt
  ```
- Preview pending release notes locally with:
  ```bash
  npx semantic-release --dry-run --no-ci
  ```
  The dry-run shows the next version, generated notes, and which commits will appear in the release.
- Alternatively, run `npm run release:evidence -- --skip-dry-run` while validating a feature branch to archive the dry-run output alongside gh auth status snapshots.
- After merging, run `npm run release:evidence -- --run-id <run-id>` (omit the flag to use the latest `release.yaml` run) so Story 1‚Äôs Evidence++ table always references fresh logs, artifacts, and dry-run output.

## üîç Troubleshooting

- **Check release status**
  ```bash
  gh run list --workflow="Release"
  gh release list | head -5
  ```
- **Inspect a specific run**
  ```bash
  gh run view <run-id> --log --job release
  ```
- **Verify permissions** ‚Äì In the job log, confirm the `Run semantic-release (GitHub plugins only)` step shows only `GITHUB_TOKEN` exported. Running the workflow with `permissions: contents: read` should fail before publishing, demonstrating the hardening check.
- **Sync locally after a release**
  ```bash
  git pull --tags
  npm install
  ```

The result is a predictable, credential-free release pipeline centered on GitHub Releases, with downloadable artifacts and a maintained changelog committed back to the repository.
